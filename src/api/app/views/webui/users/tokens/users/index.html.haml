:ruby
  if @token.description.blank?
    @pagetitle = 'Users of the token'
  else
    @pagetitle = "Users of the '#{@token.description}' token"
  end

.card.mb-3
  .card-body
    #involved-users
      %h3 Users
      - if @users.present?
        %table.responsive.table.table-sm.table-bordered.table-hover.w-100#user-table
          %thead
            %tr
              %td Username
              - if User.session
                %td
          %tbody
            - @users.each do |record|
              %tr
                %td.align-middle
                  = image_tag_for(record, size: 20)
                  = link_to(display_name(record), user_or_group_path(record))
                - if User.session
                  %td.text-nowrap
                    = link_to('#', class: 'text-light ml-auto', data: { toggle: 'modal',
                                                                        target: '#delete-user-from-token-modal',
                                                                        action: token_user_path(token_id: @token.id, id: record.id),
                                                                        confirmation_text: "Please confirm you want to remove this user #{record.login} from the token." }) do
                      %i.fa.fa-times-circle.text-danger{ title: 'Remove user from token' }
                    = render ConfirmationDialogComponent.new(modal_id: 'delete-user-from-token-modal',
                                                             method: :delete,
                                                             options: { remote: false,
                                                                        modal_title: 'Do you really want to remove this user?' })
      .pt-4
        = render(partial: 'webui/users/tokens/users/add_user_to_token_dialog', locals: { token: @token })
        = link_to('#', data: { toggle: 'modal', target: '#add-user-to-token-modal' }, id: 'add-user-to-token') do
          %i.fas.fa-plus-circle.text-primary
          Add User

:javascript
  // TODO: move this JS to confirmation_dialog_component.html.haml so this can be reused by any piece of code using the component.
  //       It has to be generic, taking the modal id from the DOM.
  $(document).ready(function() {
    $('#delete-user-from-token-modal').on('show.bs.modal', function (event) {
      var link = $(event.relatedTarget);
      $(this).find('.confirmation-text').text(link.data('confirmation-text'));
      $(this).find('form').attr('action', link.data('action'));
    });
  });

