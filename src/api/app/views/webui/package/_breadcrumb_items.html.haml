= render partial: 'webui/project/breadcrumb_items'

-# The package doesn't exist in the context of package#new, so we don't check other paths below to avoid exceptions
- if current_page?(new_package_path(@project))
  %li.breadcrumb-item.active{ 'aria-current' => 'page' }
    Create Package
- else
  %li.breadcrumb-item.text-word-break-all.col.text-truncate
    %i.fa.fa-archive
    = link_to(@package, package_show_path(@project, @package))
  - if current_page?(package_view_revisions_path(@project, @package))
    %li.breadcrumb-item.active{ 'aria-current' => 'page' }
      Revisions
  - if current_page?(package_requests_path(@project, @package))
    %li.breadcrumb-item.active{ 'aria-current' => 'page' }
      Requests
  - if current_page?(package_users_path(@project, @package))
    %li.breadcrumb-item.active{ 'aria-current' => 'page' }
      Users
  - if controller_name == 'package' && action_name == 'binaries'
    %li.breadcrumb-item.active{ 'aria-current' => 'page' }
      Repository State
  - if controller_name == 'package' && action_name == 'binary'
    %li.breadcrumb-item.active{ 'aria-current' => 'page' }
      Binary
  - if current_page?(package_dependency_path(@project, @package))
    %li.breadcrumb-item
      = link_to('Binary', package_binary_path(project: @dependant_project, package: @package_name, repository: @dependant_repository,
                                              arch: @arch, filename: @filename))
    %li.breadcrumb-item.active{ 'aria-current' => 'page' }
      Dependency
  - if current_page?(package_show_path(@project, @package))
    %li.breadcrumb-item.active.col-auto{ 'aria-current' => 'page' }
      Overview
  - if controller_name == 'package' && action_name == 'live_build_log'
    %li.breadcrumb-item.active{ 'aria-current' => 'page' }
      Build Log
  - if controller_name == 'package' && action_name == 'statistics'
    %li.breadcrumb-item
      = link_to 'Repository State', package_binaries_path(@project, @package_name, @repository)
    %li.breadcrumb-item.active{ 'aria-current' => 'page' }
      Statistics
  - if current_page?(package_view_file_path(@project, @package))
    %li.breadcrumb-item.active.text-word-break-all{ 'aria-current' => 'page' }
      = truncate(@filename, length: 50)

:javascript
//  truncateLongBreadcrumbItems();

- content_for :ready_function do
  :javascript
    function truncateLongBreadcrumbItems() {
      const max_link_length = 35;
      const truncation_length = 10;
      $('.breadcrumb-item > a').each(function(_, e) {
        var link_text = e.text;
        if (link_text.length > max_link_length) {
          var truncated_text = link_text.substring(0, truncation_length).trim() + '...' + link_text.substring(link_text.length - truncation_length, link_text.length).trim();
          e.text = truncated_text;
        }
      });
    }
    truncateLongBreadcrumbItems();
